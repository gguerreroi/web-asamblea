<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lista de Asistencia</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a81368914c.js"></script>
</head>
<body class="bg-gray-300">
<%- include('../partials/header.ejs') %>
<br>
<div class="flex w-screen justify-center items-center">
    <div class="bg-white w-5/6 m-4 py-8 px-4 rounded-lg shadow-lg ">
        <div class="text-center">
            <div class="float-right p-2 mr-2 " id="btnActions">
                <button class="bg-green-600 hover:bg-green-700 focus:outline-none text-white p-3 rounded-lg"
                        onclick="exportTableToExcel('tbasistencia', 'ListadoAsistencia')"><i
                            class="fas fa-file-excel"></i>
                    Excel
                </button>
                <button class="bg-blue-600 hover:bg-blue-700 focus:outline-none text-white p-3 rounded-lg"
                        onclick="exportTableToWord('tbasistencia', 'ListadoAsistencia')"><i
                            class="fas fa-file-word"></i>
                    Word
                </button>
                <button class="bg-gray-400 hover:bg-gray-500 hover:outline-black text-black p-3 rounded-lg"
                        onclick="sendPrint()"
                ><i class="fas fa-print"></i> Impresora
                </button>
            </div>
        </div>
        <div>
            <table class="table-auto" id="tbasistencia" width="100%">
                <caption class="text-2xl font-semibold p-2">Listado de Asistencia</caption>
                <thead class="">
                <tr class="bg-gray-800 text-gray-300 text-center">
                    <th>FECHA Y HORA</th>
                    <th>CODIGO ASOCIADO</th>
                    <th>NOMBRE ASOCIADO</th>
                    <th>GENERO</th>
                    <th>TELEFONO</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<div class="flex w-screen justify-center items-center">
    <div class="bg-white w-5/6 m-4 py-8 px-4 rounded-lg shadow-lg ">
        <div class="text-center">
            <div class="float-right p-2 mr-2 " id="btnActions">
                <button class="bg-green-600 hover:bg-green-700 focus:outline-none text-white p-3 rounded-lg"
                        onclick="exportTableToExcel('tbacta', 'ListadoAsistencia')"><i
                            class="fas fa-file-excel"></i>
                    Excel
                </button>
                <button class="bg-blue-600 hover:bg-blue-700 focus:outline-none text-white p-3 rounded-lg"
                        onclick="exportTableToWord('tbacta', 'ListadoAsistencia')"><i
                            class="fas fa-file-word"></i>
                    Word
                </button>
                <button class="bg-gray-400 hover:bg-gray-500 hover:outline-black text-black p-3 rounded-lg"
                        onclick="sendPrint()"
                ><i class="fas fa-print"></i> Impresora
                </button>
            </div>
        </div>
        <div>
            <table class="table-auto" id="tbacta" width="100%">
                <caption class="text-2xl font-semibold p-2">Listado de Asistencia para el acta</caption>
                <thead class="">
                <tr class="bg-gray-800 text-gray-300 text-center">
                    <th>Lista </th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<%- include('../partials/common.ejs'); -%>
<script
        src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

<script>
    function sendPrint() {
        $("#btnActions").hide()
        window.print()
        $("#btnActions").show()
    }

    function exportTableToExcel(tableID, filename = '') {
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

        // Specify file name
        filename = filename ? filename + '.xls' : 'excel_data.xls';

        // Create download link element
        downloadLink = document.createElement("a");

        document.body.appendChild(downloadLink);

        if (navigator.msSaveOrOpenBlob) {
            var blob = new Blob(['\ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

            // Setting the file name
            downloadLink.download = filename;

            //triggering the function
            downloadLink.click();
        }
    }

    function exportTableToWord(tableID, filename = '') {
        var downloadLink;
        var dataType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document; charset=utf-8';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

        // Specify file name
        filename = filename ? filename + '.doc' : 'word_data.doc';

        // Create download link element
        downloadLink = document.createElement("a");

        document.body.appendChild(downloadLink);

        if (navigator.msSaveOrOpenBlob) {
            var blob = new Blob(['\ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            // Create a link to the file
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

            // Setting the file name
            downloadLink.download = filename;

            //triggering the function
            downloadLink.click();
        }
    }

    let tbasistencia;
    $(document).ready(function () {
        tbasistencia = $("#tbasistencia").DataTable({
            lengthChange: false,
            searching: false,
            paging: false,
            ajax: `${URL_API}/asamblea/asistencia`,
            columns: [
                {"data": "FechaHora"},
                {"data": "CodCliente"},
                {"data": "StrNombreAsociado"},
                {"data": "CodGenero"},
                {"data": "NumTelefono"}
            ]
        })

        $.ajax({
            url: `${URL_API}/asamblea/asistencia`,
            method: 'GET',
        }).then(resp => {
            const {data} = resp;
            let str = "";
            data.forEach(function (value, index){
                str = str + value.StrNombreAsociado + ','
            })
            $("#tbacta tbody").append(str)
        })
    })
</script>
</body>
</html>
